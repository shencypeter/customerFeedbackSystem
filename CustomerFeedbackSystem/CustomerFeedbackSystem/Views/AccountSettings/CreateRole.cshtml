@model CustomerFeedbackSystem.Models.CreateUser

@{
    ViewData["Title"] = "帳號設定－應用群組管理";
    Layout = "_NoNavLayout";

    var allRoles = ViewData["AllRoles"] as List<Role> ?? new();
    var rolesByGroup = allRoles
        .GroupBy(r => r.RoleGroup)
        .OrderBy(g => g.Key)
        .ToList();

    int roleIndex = 0;
}

<div class="m-4">
    <h4 class="m-3 px-2">
        <i class="bi bi-gear-fill me-2"></i>@ViewData["Title"]
    </h4>

    <div class="pop">



        <!-- ========================= -->
        <!-- ③ Add new app group      -->
        <!-- ========================= -->
        <form method="post">
            @Html.AntiForgeryToken()

            <div class="row my-3 align-items-center">
                <div class="col-md-2 col-form-label text-md-end text-start">
                    <strong>新增群組</strong>
                </div>

                <div class="col-md-6">
                    <input type="text"
                           name="RoleName"
                           class="form-control"
                           placeholder="輸入新的應用群組名稱"
                           required />
                </div>

                <div class="col-md-4 text-start mt-2 mt-md-0">
                    <button type="submit"
                            class="btn2 btn-primary"
                            formmethod="post"
                            formaction="@Url.Action("CreateGroup","Feedback")">
                        <i class="fas fa-plus-circle"></i>&ensp;新增群組
                    </button>
                </div>
            </div>
        </form>


        <hr />
        <!-- ========================= -->
        <!-- ① Rename existing groups -->
        <!-- ========================= -->
        <form method="post" >
            @Html.AntiForgeryToken()

            <div class="row my-3">
                <div class="col-md-2 col-form-label text-md-end text-start">
                    <strong>重新命名群組</strong>
                </div>
                <div class="col-md-10">

                    @foreach (var group in rolesByGroup)
                    {
                        foreach (var item in group)
                        {
                            var groupName = item.RoleName.Split('|')[0];
                            <div class="input-group mb-2">
                                <span class="input-group-text">@groupName</span>
                                <input type="text"
                                       name="GroupRename[@groupName]"
                                       class="form-control"
                                       placeholder="重新命名為...(保持空白維持現狀)" />
                            </div>
                        }
                    }

                </div>
            </div>

            <div class="row my-3">
                <div class="col-12 text-center">
                    <button type="submit"
                            class="btn2 btn-success col-6 col-md-3"
                            formmethod="post"
                            formaction="@Url.Action("RenameGroup", "Feedback")">
                        <i class="fas fa-save"></i>&ensp;儲存重新命名
                    </button>
                </div>
            </div>
        </form>

        <hr />

        <!-- ========================= -->
        <!-- ② Delete checked roles   -->
        <!-- ========================= -->
        <form method="post" onsubmit="return confirm('群組與內部相關人員將被移出, 請確認?');">
            @Html.AntiForgeryToken()

            <div class="row my-3">
                <div class="col-md-2 col-form-label text-md-end text-start">
                    <strong>刪除群組</strong>
                </div>

                <div class="col-md-10">
                    @foreach (var group in rolesByGroup)
                    {
                        foreach( var item in group)
                        {
                            var groupName = item.RoleName.Split('|')[0];
                            <div class="form-check mb-2">
                                <input class="form-check-input"
                                        type="checkbox"
                                        name="GroupName[@groupName]"
                                        value="@item.RoleName"
                                        id="del_@item.RoleName" />
                                <label class="form-check-label" for="del_@item.RoleName">
                                    @item.RoleName
                                </label>
                            </div>
                        }
                   
                    }
                </div>
            </div>

            <div class="row my-3">
                <div class="col-12 text-center">
                    <button type="submit"
                            class="btn2 btn-danger col-6 col-md-3"
                            formmethod="post"
                            formaction="@Url.Action("DeleteGroup", "Feedback")"
                     >
                        <i class="fas fa-trash-alt"></i>&ensp;刪除群組
                    </button>
                </div>
            </div>
        </form>

        

    </div>
</div>
